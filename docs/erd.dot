digraph LogisticsIoT_Full_Detailed_Fixed {
    graph [
        rankdir="LR"
        nodesep=0.6  // Jarak vertikal antar tabel
        ranksep=1.2  // Jarak horizontal diperlebar biar kabel lega
        splines=ortho // Garis siku-siku
        pad="0.5"
        fontname="Arial"
        bgcolor="#FFFFFF"
    ];
    
    node [
        shape=plaintext
        fontname="Arial"
        fontsize=10
    ];
    
    edge [
        fontname="Arial"
        fontsize=9
        color="#444444"
        arrowsize=0.7
    ];

    // ==================================================
    // CLUSTER 1: AUTHENTICATION & USERS (BLUE)
    // ==================================================
    subgraph cluster_auth {
        label="AUTH & USERS"
        style=filled
        color="#E1F5FE"

        users [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#0288D1"><B><FONT COLOR="WHITE">users</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>user_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_role"><B>role_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT">username</TD><TD ALIGN="LEFT">VARCHAR(50)</TD><TD ALIGN="LEFT">UQ</TD></TR>
                <TR><TD ALIGN="LEFT">email</TD><TD ALIGN="LEFT">VARCHAR(255)</TD><TD ALIGN="LEFT">UQ</TD></TR>
                <TR><TD ALIGN="LEFT">password_hash</TD><TD ALIGN="LEFT">VARCHAR(255)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">updated_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        user_profiles [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#0288D1"><B><FONT COLOR="WHITE">user_profiles</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>profile_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_user"><B>user_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK/UQ</B></TD></TR>
                <TR><TD ALIGN="LEFT">full_name</TD><TD ALIGN="LEFT">VARCHAR(100)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">gender</TD><TD ALIGN="LEFT">ENUM</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">date_of_birth</TD><TD ALIGN="LEFT">DATE</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">phone_number</TD><TD ALIGN="LEFT">VARCHAR(20)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">address</TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">avatar_url</TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">updated_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        refresh_tokens [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#0288D1"><B><FONT COLOR="WHITE">refresh_tokens</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>token</B></TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_user"><B>user_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT">expires_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">revoked_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">updated_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        roles [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#0277BD"><B><FONT COLOR="WHITE">roles</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>role_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT">name</TD><TD ALIGN="LEFT">VARCHAR(50)</TD><TD ALIGN="LEFT">UQ</TD></TR>
                <TR><TD ALIGN="LEFT">description</TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        permissions [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#0277BD"><B><FONT COLOR="WHITE">permissions</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>permission_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT">name</TD><TD ALIGN="LEFT">VARCHAR(100)</TD><TD ALIGN="LEFT">UQ</TD></TR>
                <TR><TD ALIGN="LEFT">description</TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        role_permissions [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#0277BD"><B><FONT COLOR="WHITE">role_permissions</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_role"><B>role_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK/FK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_perm"><B>permission_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK/FK</B></TD></TR>
            </TABLE>
        >];
    }

    // ==================================================
    // CLUSTER 2: MASTER DATA (GREEN)
    // ==================================================
    subgraph cluster_master {
        label="MASTER DATA (LIBRARY)"
        style=filled
        color="#E8F5E9" 

        containers [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#2E7D32"><B><FONT COLOR="WHITE">containers</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>container_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT">name</TD><TD ALIGN="LEFT">VARCHAR(100)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">inner_length_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">inner_width_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">inner_height_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">max_weight_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">description</TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        products [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#2E7D32"><B><FONT COLOR="WHITE">products</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>product_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT">sku</TD><TD ALIGN="LEFT">VARCHAR(50)</TD><TD ALIGN="LEFT">UQ</TD></TR>
                <TR><TD ALIGN="LEFT">name</TD><TD ALIGN="LEFT">VARCHAR(150)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">length_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">width_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">height_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">weight_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">allow_rotation</TD><TD ALIGN="LEFT">BOOLEAN</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">stacking_limit</TD><TD ALIGN="LEFT">INTEGER</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">color_hex</TD><TD ALIGN="LEFT">VARCHAR(7)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];
    }

    // ==================================================
    // CLUSTER 3: CALCULATION (ORANGE)
    // ==================================================
    subgraph cluster_calc {
        label="CALCULATION ENGINE"
        style=filled
        color="#FFF3E0" 

        load_plans [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#EF6C00"><B><FONT COLOR="WHITE">load_plans</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>plan_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT">plan_code</TD><TD ALIGN="LEFT">VARCHAR(50)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">status</TD><TD ALIGN="LEFT">VARCHAR(20)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">cont_name</TD><TD ALIGN="LEFT">VARCHAR(100)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">cont_length_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">cont_width_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">cont_height_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">cont_max_weight_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        load_items [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#EF6C00"><B><FONT COLOR="WHITE">load_items</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>item_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_plan"><B>plan_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT">item_label</TD><TD ALIGN="LEFT">VARCHAR(150)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">length_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">width_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">height_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">weight_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">quantity</TD><TD ALIGN="LEFT">INTEGER</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">allow_rotation</TD><TD ALIGN="LEFT">BOOLEAN</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">color_hex</TD><TD ALIGN="LEFT">VARCHAR(7)</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        plan_results [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#EF6C00"><B><FONT COLOR="WHITE">plan_results</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>result_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_plan"><B>plan_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT">total_loaded_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">volume_utilization_pct</TD><TD ALIGN="LEFT">NUMERIC(5,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">is_feasible</TD><TD ALIGN="LEFT">BOOLEAN</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">calculated_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        plan_placements [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#EF6C00"><B><FONT COLOR="WHITE">plan_placements</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>placement_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_result"><B>result_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_item"><B>item_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT">pos_x_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">pos_y_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">pos_z_mm</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">rotation_code</TD><TD ALIGN="LEFT">INTEGER</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">step_number</TD><TD ALIGN="LEFT">INTEGER</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];
    }

    // ==================================================
    // CLUSTER 4: IoT & EXECUTION (PURPLE)
    // ==================================================
    subgraph cluster_iot {
        label="IoT & EXECUTION"
        style=filled
        color="#F3E5F5" 

        devices [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#7B1FA2"><B><FONT COLOR="WHITE">devices</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>device_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT">name</TD><TD ALIGN="LEFT">VARCHAR(100)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">api_key</TD><TD ALIGN="LEFT">VARCHAR(64)</TD><TD ALIGN="LEFT">UQ</TD></TR>
                <TR><TD ALIGN="LEFT">calibration_factor</TD><TD ALIGN="LEFT">NUMERIC(10,6)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">tare_offset</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">is_active</TD><TD ALIGN="LEFT">BOOLEAN</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">last_heartbeat_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];

        execution_logs [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#7B1FA2"><B><FONT COLOR="WHITE">execution_logs</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>log_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_plan"><B>plan_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_device"><B>device_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT">step_number</TD><TD ALIGN="LEFT">INTEGER</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">expected_weight_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">actual_weight_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">weight_diff_kg</TD><TD ALIGN="LEFT">NUMERIC(10,2)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">is_passed</TD><TD ALIGN="LEFT">BOOLEAN</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">message</TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];
    }

    // ==================================================
    // CLUSTER 5: AUDIT (GREY)
    // ==================================================
    subgraph cluster_audit {
        label="AUDIT SYSTEM"
        style=filled
        color="#ECEFF1" 

        audit_trails [label=<
            <TABLE BORDER="0" CELLBORDER="1" CELLSPACING="0" BGCOLOR="#FFFFFF">
                <TR><TD COLSPAN="3" BGCOLOR="#546E7A"><B><FONT COLOR="WHITE">audit_trails</FONT></B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="pk"><B>audit_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>PK</B></TD></TR>
                <TR><TD ALIGN="LEFT" PORT="fk_user"><B>user_id</B></TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"><B>FK</B></TD></TR>
                <TR><TD ALIGN="LEFT">action</TD><TD ALIGN="LEFT">VARCHAR(50)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">entity_name</TD><TD ALIGN="LEFT">VARCHAR(100)</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">entity_id</TD><TD ALIGN="LEFT">UUID</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">old_values</TD><TD ALIGN="LEFT">JSONB</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">new_values</TD><TD ALIGN="LEFT">JSONB</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">ip_address</TD><TD ALIGN="LEFT">INET</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">user_agent</TD><TD ALIGN="LEFT">TEXT</TD><TD ALIGN="LEFT"></TD></TR>
                <TR><TD ALIGN="LEFT">created_at</TD><TD ALIGN="LEFT">TIMESTAMP</TD><TD ALIGN="LEFT"></TD></TR>
            </TABLE>
        >];
    }

    // ==================================================
    // RELATIONSHIPS (HARD FK)
    // ==================================================

    // Auth
    roles:pk:e -> users:fk_role:w;
    roles:pk:e -> role_permissions:fk_role:w;
    permissions:pk:e -> role_permissions:fk_perm:w;
    users:pk:e -> user_profiles:fk_user:w;
    users:pk:e -> refresh_tokens:fk_user:w;

    // Calculation
    load_plans:pk:e -> load_items:fk_plan:w;
    load_plans:pk:e -> plan_results:fk_plan:w;
    plan_results:pk:e -> plan_placements:fk_result:w;
    load_items:pk:e -> plan_placements:fk_item:w;

    // IoT
    devices:pk:e -> execution_logs:fk_device:w;
    load_plans:pk:e -> execution_logs:fk_plan:w;
    
    // Audit
    users:pk:e -> audit_trails:fk_user:w [style=dotted];

    // ==================================================
    // LOGICAL / SNAPSHOT RELATIONS (DOTTED GREEN)
    // ==================================================
    products:pk:e -> load_items:pk:w [style=dashed color="#2E7D32" label="Snapshot"];
    containers:pk:e -> load_plans:pk:w [style=dashed color="#2E7D32" label="Snapshot"];
}
